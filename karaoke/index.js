let lyrics = [
  ["Hồn ", 35.144, 35.144],
  ["lỡ ", 35.144, 35.587997],
  ["sa ", 35.587997, 36.006],
  ["vào ", 36.475998, 36.475998],
  ["đôi ", 36.475998, 36.972],
  ["mắt ", 36.972, 37.495],
  ["em", 37.495, 37.939],
  ["Chiều ", 37.939, 42.641],
  ["nao ", 42.641, 43.085],
  ["xõa ", 43.085, 43.476997],
  ["tóc ", 43.476997, 43.869],
  ["ngồi ", 43.869, 44.443],
  ["bên ", 44.443, 45.017998],
  ["rèm", 45.017998, 45.488],
  ["Thầm ", 45.488, 49.276],
  ["ước ", 49.276, 49.694],
  ["nhưng ", 49.694, 50.059998],
  ["nào ", 50.059998, 50.503998],
  ["đâu ", 50.503998, 51.026],
  ["dám ", 51.026, 51.575],
  ["nói ", 51.575, 52.097],
  ["Khép ", 52.097, 53.325],
  ["tâm ", 53.325, 53.769],
  ["tư ", 53.769, 54.37],
  ["lại ", 54.37, 54.971],
  ["thôi ", 54.971, 55.415],
  ["Đường ", 55.415, 56.669],
  ["hoa ", 56.669, 57.139],
  ["vẫn ", 57.1396, 57.766],
  ["chưa ", 57.766, 57.922],
  ["mở ", 57.922, 58.471],
  ["lối ", 58.471, 58.940998],
  ["Đời ", 58.940998, 62.572],
  ["lắm ", 62.572, 63.042],
  ["phong ", 63.04, 63.408],
  ["trần ", 63.408, 63.8],
  ["tay ", 63.8, 64.34901],
  ["trắng ", 64.34901, 64.949005],
  ["tay", 64.949005, 65.289],
  ["Trời ", 65.289, 69.26],
  ["đông ", 69.26, 69.73],
  ["ngại ", 69.73, 70.122],
  ["gió ", 70.122, 70.513],
  ["lùa ", 70.513, 71.036],
  ["vai ", 71.036, 71.637],
  ["Lầu ", 71.637, 72.133],
  ["kín ", 72.133, 75.973],
  ["trăng ", 75.973, 76.39101],
  ["về ", 76.39101, 76.783005],
  ["không ", 76.783005, 77.149],
  ["lối ", 77.149, 77.723],
  ["chiếu ", 77.723, 78.768005],
  ["Gác ", 78.768005, 80.100006],
  ["cao ", 80.100006, 80.518005],
  ["ngăn ", 80.518005, 81.171005],
  ["niềm ", 81.171005, 81.746],
  ["yêu ", 81.746, 82.269005],
  ["thì ", 82.269005, 83.444],
  ["thôi ", 83.444, 83.888],
  ["mơ ", 83.888, 84.515],
  ["ước ", 84.515, 84.672005],
  ["chi ", 84.672005, 85.168],
  ["nhiều", 85.168, 85.769005],
  ["Bên", 85.769005, 91.411],
  [" nhau", 91.411, 92.117004],
  [" sao", 92.117004, 93.292],
  [" tình", 93.292, 93.815],
  [" xa", 93.815, 94.416],
  [" vạn", 94.416, 95.042],
  [" lý", 95.042, 95.539],
  [" cách", 95.539, 96.740005],
  [" biệt", 96.740005, 97.263],
  [" mấy", 97.838005, 97.838005],
  [" sơn", 98.491005, 98.491005],
  [" khê", 98.491005, 98.935005],
  [" Ngày", 98.935005, 101.233],
  [" đi", 101.233, 102.148],
  [" mắt", 102.148, 103.34901],
  [" em", 103.34901, 103.767006],
  [" xanh", 103.767006, 104.473],
  [" biển", 104.473, 105.126],
  [" sâu", 105.126, 105.596],
  [" mắt", 105.596, 106.719],
  [" tôi", 106.719, 107.137],
  [" rưng", 107.137, 107.921005],
  [" rưng", 107.921005, 108.913],
  [" sầu", 108.913, 110.455],
  [" nghe", 110.455, 111.108],
  [" tiếng", 111.108, 111.709],
  [" pháo", 111.709, 112.205],
  [" tiễn", 112.205, 112.962006],
  [" ai", 112.962006, 113.824005],
  [" cầu", 113.824005, 114.582],
  [" Đường", 114.582, 115.496],
  [" phố", 115.496, 116.228004],
  [" muôn", 116.228004, 116.72401],
  [" màu", 116.72401, 117.064],
  [" sao", 117.064, 117.534004],
  [" thiếu", 117.534004, 118.082],
  [" em", 118.082, 118.579],
  [" Về", 118.579, 122.628006],
  [" đâu", 122.628006, 123.046005],
  [" làn", 123.046005, 123.464005],
  [" tóc", 123.464005, 123.882],
  [" xõa", 123.882, 124.404],
  [" bên", 124.404, 124.979004],
  [" rèm", 124.979004, 125.449005],
  [" lầu", 125.449005, 129.263],
  [" vắng", 129.263, 129.707],
  [" không", 129.707, 130.073],
  [" người", 130.073, 130.464],
  [" sống", 130.464, 131.118],
  [" khép", 131.118, 131.666],
  [" kín", 131.666, 132.18901],
  [" Nhớ", 132.18901, 133.46901],
  [" em", 133.46901, 133.91301],
  [" tôi", 133.91301, 134.461],
  [" gọi", 134.461, 135.088],
  [" chỉ", 135.088, 136.70801],
  [" nghe", 136.70801, 137.20401],
  [" tiếng", 137.20401, 137.85701],
  [" lá", 137.85701, 138.171],
  [" rơi", 138.171, 139.059],
  [" thềm", 139.059, 139.58101],
  [" Bên", 139.58101, 168.10701],
  [" Nhau", 168.10701, 169.021],
  [" sao", 169.021, 170.06601],
  [" tình", 170.06601, 170.48401],
  [" xa", 170.48401, 171.11101],
  [" vạn", 171.11101, 171.738],
  [" lý", 171.738, 172.20801],
  [" cách", 172.20801, 173.358],
  [" biệt", 173.358, 173.828],
  [" mấy", 173.828, 174.429],
  [" sơn", 174.429, 175.134],
  [" khê", 175.134, 175.552],
  [" Ngày", 175.552, 177.981],
  [" đi", 177.981, 178.713],
  [" mắt", 178.713, 180.019],
  [" em", 180.019, 180.489],
  [" xanh", 180.489, 181.09],
  [" biển", 181.09, 181.743],
  [" sâu", 181.743, 182.161],
  [" mắt", 182.161, 183.389],
  [" tôi", 183.389, 183.83301],
  [" rưng", 183.83301, 184.46],
  [" rưng", 184.46, 185.087],
  [" sầu", 185.087, 185.531],
  [" Lặng", 185.531, 187.15001],
  [" nghe", 187.15001, 187.856],
  [" tiếng", 187.856, 188.378],
  [" pháo", 188.378, 188.639],
  [" tiễn", 188.639, 189.031],
  [" ai", 189.031, 189.58],
  [" qua", 189.58, 189.97101],
  [" cầu", 189.97101, 191.878],
  [" Đường", 191.878, 192.479],
  [" phố", 192.479, 192.949],
  [" muôn", 192.949, 193.472],
  [" màu", 193.472, 193.864],
  [" sao", 193.864, 194.464],
  [" thiếu", 194.464, 195.039],
  [" em", 195.039, 195.536],
  [" Về", 195.536, 199.271],
  [" đâu", 199.271, 199.68901],
  [" làn", 199.68901, 200.133],
  [" tóc", 200.133, 200.52501],
  [" xõa", 200.52501, 201.047],
  [" bên", 201.047, 201.62201],
  [" rèm", 201.62201, 202.144],
  [" lầu", 202.144, 205.932],
  [" vắng", 205.932, 206.35],
  [" không", 206.35, 206.742],
  [" người", 206.742, 207.108],
  [" song", 207.108, 207.709],
  [" khép", 207.709, 208.336],
  [" kín", 208.336, 208.806],
  [" Nhớ", 208.806, 210.033],
  [" em", 210.033, 210.478],
  [" tôi", 210.478, 211.104],
  [" gọi", 211.104, 211.627],
  [" chỉ", 211.627, 212.149],
  [" nghe", 212.149, 213.90001],
  [" tiếng", 213.90001, 214.709],
  [" lá", 214.709, 215.284],
  [" rơi", 215.284, 215.493],
  [" thềm", 215.493, 215.83301],
  [" Lầu", 215.83301, 219.307],
  [" vắng", 219.307, 219.699],
  [" không", 219.699, 220.117],
  [" người", 220.117, 220.535],
  [" song", 220.535, 221.162],
  [" khép", 221.162, 221.684],
  [" kín", 221.684, 222.233],
  [" Nhớ", 222.233, 223.513],
  [" em", 223.513, 223.904],
  [" tôi", 223.904, 224.558],
  [" gọi", 224.558, 225.184],
  [" tên", 225.184, 225.602],
  [" chỉ", 225.602, 226.935],
  [" nghe", 226.935, 229.05101],
  [" tiếng", 229.05101, 232.96901],
  [" lá", 232.96901, 234.06601],
  [" rơi", 234.06601, 235.13701],
  [" thềm", 235.13701, 236.522],

  // ...
];

let subLyrics = [
  ["Hồn lỡ sa vào đôi mắt em", 35.144, 37.939],
  ["Chiều nao xõa tóc ngồi bên rèm", 37.939, 45.488],
  ["Thầm ước nhưng nào đâu dám nói", 49.276, 52.097],
  ["Khép tâm tư lại thôi", 53.325, 55.415],
  ["Đường hoa vẫn chưa mở lối", 56.669, 58.940998],
  ["Đời lắm phong trần tay trắng tay", 62.572, 65.289],
  ["Trời đông lạnh giá lùa vai gầy", 69.26, 72.133],
  ["lầu kín trăng về không lối chiếu", 75.973, 78.768005],
  ["Gác cao ngăn niềm yêu", 80.100006, 82.269005],
  ["Thì thôi mơ ước chi nhiều", 83.444, 85.769005],
  ["Bên nhau sao tình xa vạn lý", 91.411, 95.539],
  ["Cách biệt mấy sơn khê", 96.740005, 98.935005],
  ["Ngày đi mắt em xanh biển sâu", 101.233, 105.596],
  ["Mắt tôi rưng rưng sầu", 106.719, 108.913],
  ["lặng nghe tiếng pháo tiễn ai qua cầu", 110.455, 114.922005],
  ["Đường phố muôn màu sao thiếu em", 115.496, 118.579],
  ["Về đâu làn tóc xõa bên rèm", 122.628006, 125.449005],
  ["Lầu vắng không người song khép kín", 129.263, 132.18901],
  ["Nhớ em tôi gọi tên", 133.46901, 135.584],
  ["Chỉ nghe tiếng lá rơi thềm", 136.70801, 139.58101],
  ["Bên nhau sao tình xa vạn lý", 168.10701, 172.20801],
  ["Cách biệt mấy sơn khê", 173.358, 173.828],
  ["Ngày đi mắt em xanh biển sâu", 177.981, 182.161],
  ["Mắt tôi rưng rưng sầu", 183.389, 185.531],
  ["lặng nghe tiếng pháo tiễn ai qua cầu", 187.15001, 191.878],
  ["Đường phố muôn màu sao thiếu em", 192.479, 195.536],
  ["Về đâu làn tóc xõa bên rèm", 199.271, 202.144],
  ["Lầu vắng không người song khép kín", 205.932, 208.806],
  ["Nhớ em tôi gọi tên", 210.033, 212.149],
  ["Chỉ nghe tiếng lá rơi thềm", 213.429, 215.83301],
  ["Lầu vắng không người song khép kín", 219.307, 222.233],
  ["Nhớ em tôi gọi tên", 223.513, 225.602],
  ["Chỉ nghe tiếng lá rơi thềm", 226.935, 236.522],
];

let docLyrics = [];
let arrLyrics = [];

const textLyrics = `<data>
<param s="b">
   <i va="35.144">Hồn </i>
   <i va="35.587997">lỡ </i>
   <i va="36.006">sa </i>
   <i va="36.475998">vào </i>
   <i va="36.972">đôi </i>
   <i va="37.495">mắt </i>
   <i va="37.939">em</i>
</param>
<param s="b">
   <i va="42.641">Chiều </i>
   <i va="43.085">nao </i>
   <i va="43.476997">xõa </i>
   <i va="43.869">tóc </i>
   <i va="44.443">ngồi </i>
   <i va="45.017998">bên </i>
   <i va="45.488">rèm</i>
</param>
<param s="b">
   <i va="49.276">Thầm </i>
   <i va="49.694">ước </i>
   <i va="50.059998">nhưng </i>
   <i va="50.503998">nào </i>
   <i va="51.026">đâu </i>
   <i va="51.575">dám </i>
   <i va="52.097">nói</i>
</param>
<param s="b">
   <i va="53.325">Khép </i>
   <i va="53.769">tâm </i>
   <i va="54.37">tư </i>
   <i va="54.971">lại </i>
   <i va="55.415">thôi</i>
</param>
<param s="b">
   <i va="56.669">Đường </i>
   <i va="57.139">hoa </i>
   <i va="57.766">vẫn </i>
   <i va="57.922">chưa </i>
   <i va="58.471">mở </i>
   <i va="58.940998">lối</i>
</param>
<param s="b">
   <i va="62.572">Đời </i>
   <i va="63.042">lắm </i>
   <i va="63.408">phong </i>
   <i va="63.8">trần </i>
   <i va="64.34901">tay </i>
   <i va="64.949005">trắng </i>
   <i va="65.289">tay</i>
</param>
<param s="b">
   <i va="69.26">Trời </i>
   <i va="69.73">đông </i>
   <i va="70.122">ngại </i>
   <i va="70.513">gió </i>
   <i va="71.036">lùa </i>
   <i va="71.637">vai </i>
   <i va="72.133">gầy</i>
</param>
<param s="b">
   <i va="75.973">Lầu </i>
   <i va="76.39101">kín </i>
   <i va="76.783005">trăng </i>
   <i va="77.149">về </i>
   <i va="77.723">không </i>
   <i va="78.272">lối </i>
   <i va="78.768005">chiếu</i>
</param>
<param s="b">
   <i va="80.100006">Gác </i>
   <i va="80.518005">cao </i>
   <i va="81.171005">ngăn </i>
   <i va="81.746">niềm </i>
   <i va="82.269005">yêu</i>
</param>
<param s="b">
   <i va="83.444">Thì </i>
   <i va="83.888">thôi </i>
   <i va="84.515">mơ </i>
   <i va="84.672005">ước </i>
   <i va="85.168">chi </i>
   <i va="85.769005">nhiều</i>
</param>
<param s="b">
   <i va="91.411">Bên </i>
   <i va="92.117004">nhau </i>
   <i va="93.292">sao </i>
   <i va="93.815">tình </i>
   <i va="94.416">xa </i>
   <i va="95.042">vạn </i>
   <i va="95.539">lý </i>
   <i va="96.740005">cách </i>
   <i va="97.263">biệt </i>
   <i va="97.838005">mấy </i>
   <i va="98.491005">sơn </i>
   <i va="98.935005">khê</i>
</param>
<param s="b">
   <i va="101.233">Ngày </i>
   <i va="102.148">đi </i>
   <i va="103.34901">mắt </i>
   <i va="103.767006">em </i>
   <i va="104.473">xanh </i>
   <i va="105.126">biển </i>
   <i va="105.596">sâu, </i>
   <i va="106.719">mắt </i>
   <i va="107.137">tôi </i>
   <i va="107.921005">rưng </i>
   <i va="108.469">rưng </i>
   <i va="108.913">sầu</i>
</param>
<param s="b">
   <i va="110.455">Lặng </i>
   <i va="111.108">nghe </i>
   <i va="111.709">tiếng </i>
   <i va="112.205">pháo </i>
   <i va="112.962006">tiễn </i>
   <i va="113.824005">ai </i>
   <i va="114.582">qua </i>
   <i va="114.922005">cầu</i>
</param>
<param s="b">
   <i va="115.496">Đường </i>
   <i va="116.228004">phố </i>
   <i va="116.72401">muôn </i>
   <i va="117.064">màu </i>
   <i va="117.534004">sao </i>
   <i va="118.082">thiếu </i>
   <i va="118.579">em</i>
</param>
<param s="b">
   <i va="122.628006">Về </i>
   <i va="123.046005">đâu </i>
   <i va="123.464005">làn </i>
   <i va="123.882">tóc </i>
   <i va="124.404">xõa </i>
   <i va="124.979004">bên </i>
   <i va="125.449005">rèm</i>
</param>
<param s="b">
   <i va="129.263">Lầu </i>
   <i va="129.707">vắng </i>
   <i va="130.073">không </i>
   <i va="130.464">người </i>
   <i va="131.118">song </i>
   <i va="131.666">khép </i>
   <i va="132.18901">kín</i>
</param>
<param s="b">
   <i va="133.46901">Nhớ </i>
   <i va="133.91301">em </i>
   <i va="134.461">tôi </i>
   <i va="135.088">gọi </i>
   <i va="135.584">tên, </i>
   <i va="136.70801">chỉ </i>
   <i va="137.20401">nghe </i>
   <i va="137.85701">tiếng </i>
   <i va="138.171">lá </i>
   <i va="139.059">rơi </i>
   <i va="139.58101">thềm</i>
</param>
<param s="b">
   <i va="168.10701">Bên </i>
   <i va="169.021">nhau </i>
   <i va="170.06601">sao </i>
   <i va="170.48401">tình </i>
   <i va="171.11101">xa </i>
   <i va="171.738">vạn </i>
   <i va="172.20801">lý </i>
   <i va="173.358">cách </i>
   <i va="173.828">biệt </i>
   <i va="174.429">mấy </i>
   <i va="175.134">sơn </i>
   <i va="175.552">khê</i>
</param>
<param s="b">
   <i va="177.981">Ngày </i>
   <i va="178.713">đi </i>
   <i va="180.019">mắt </i>
   <i va="180.489">em </i>
   <i va="181.09">xanh </i>
   <i va="181.743">biển </i>
   <i va="182.161">sâu, </i>
   <i va="183.389">mắt </i>
   <i va="183.83301">tôi </i>
   <i va="184.46">rưng </i>
   <i va="185.087">rưng </i>
   <i va="185.531">sầu</i>
</param>
<param s="b">
   <i va="187.15001">Lặng </i>
   <i va="187.856">nghe </i>
   <i va="188.378">tiếng </i>
   <i va="188.639">pháo </i>
   <i va="189.031">tiễn </i>
   <i va="189.58">ai </i>
   <i va="189.97101">qua </i>
   <i va="191.878">cầu</i>
</param>
<param s="b">
   <i va="192.479">Đường </i>
   <i va="192.949">phố </i>
   <i va="193.472">muôn </i>
   <i va="193.864">màu </i>
   <i va="194.464">sao </i>
   <i va="195.039">thiếu </i>
   <i va="195.536">em</i>
</param>
<param s="b">
   <i va="199.271">Về </i>
   <i va="199.68901">đâu </i>
   <i va="200.133">làn </i>
   <i va="200.52501">tóc </i>
   <i va="201.047">xõa </i>
   <i va="201.62201">bên </i>
   <i va="202.144">rèm</i>
</param>
<param s="b">
   <i va="205.932">Lầu </i>
   <i va="206.35">vắng </i>
   <i va="206.742">không </i>
   <i va="207.108">người </i>
   <i va="207.709">song </i>
   <i va="208.336">khép </i>
   <i va="208.806">kín</i>
</param>
<param s="b">
   <i va="210.033">Nhớ </i>
   <i va="210.478">em </i>
   <i va="211.104">tôi </i>
   <i va="211.627">gọi </i>
   <i va="212.149">tên, </i>
   <i va="213.429">chỉ </i>
   <i va="213.90001">nghe </i>
   <i va="214.709">tiếng </i>
   <i va="215.284">lá </i>
   <i va="215.493">rơi </i>
   <i va="215.83301">thềm</i>
</param>
<param s="b">
   <i va="219.307">Lầu </i>
   <i va="219.699">vắng </i>
   <i va="220.117">không </i>
   <i va="220.535">người </i>
   <i va="221.162">song </i>
   <i va="221.684">khép </i>
   <i va="222.233">kín</i>
</param>
<param s="b">
   <i va="223.513">Nhớ </i>
   <i va="223.904">em </i>
   <i va="224.558">tôi </i>
   <i va="225.184">gọi </i>
   <i va="225.602">tên, </i>
   <i va="226.935">chỉ </i>
   <i va="229.05101">nghe </i>
   <i va="232.96901">tiếng </i>
   <i va="234.06601">lá </i>
   <i va="235.13701">rơi </i>
   <i va="236.522">thềm</i>
</param>
</data>`;

const parser = new DOMParser();
let xmlDoc = parser
  .parseFromString(textLyrics, "text/xml")
  .getElementsByTagName("i");

let elementLyrics = parser
  .parseFromString(textLyrics, "text/xml")
  .getElementsByTagName("param");

let row = ``;
let start = xmlDoc[0].getAttribute("va");
for (let i = 0; i < xmlDoc.length; i++) {
  if (i < xmlDoc.length - 1) {
    docLyrics.push([
      xmlDoc[i].getAttribute("va"),
      xmlDoc[i + 1].getAttribute("va"),
      xmlDoc[i].innerHTML,
    ]);
  } else {
    docLyrics.push([
      xmlDoc[i].getAttribute("va"),
      xmlDoc[i].getAttribute("va"),
      xmlDoc[i].innerHTML,
    ]);
  }
  if (
    xmlDoc[i].innerHTML[0] === xmlDoc[i].innerHTML[0].toUpperCase() &&
    i !== 0
  ) {
    arrLyrics.push([start, xmlDoc[i].getAttribute("va"), row]);
    start = xmlDoc[i].getAttribute("va");
    row = ``;
  }
  row += xmlDoc[i].innerHTML;
  if (i == xmlDoc.length - 1) {
    arrLyrics.push([start, xmlDoc[i].getAttribute("va"), row]);
    start = xmlDoc[i].getAttribute("va");
    row = ``;
  }
}

let NumToTime = (num) => {
  let hours = Math.floor(num / (60 * 60));
  let minutes = Math.floor((num - hours * 60 * 60) / 60);
  let seconds = Math.ceil(num % 60);
  hours < 10 ? (hours = `0${hours}`) : hours;
  minutes < 10 ? (minutes = `0${minutes}`) : minutes;
  seconds < 10 ? (seconds = `0${seconds}`) : seconds;
  if (num >= 60 * 60) {
    return `${hours}:${minutes}:${seconds}`;
  }
  return `${minutes}:${seconds}`;
};

let playMusic = document.querySelector("#player");
let stopper = document.querySelector("#stopper");
let audio = document.getElementById("audio");
let slider = document.querySelector("#slider");
let duration = document.querySelector("#duration");
let currentTime = document.querySelector("#currentTime");
let lyricsTag = document.querySelector("#lyrics");
let sublyricsTag = document.querySelector("#sublyrics");
let handleAudio;
let handleChangeColor;

duration.innerText = NumToTime(Math.ceil(audio.duration));
currentTime.innerText = NumToTime(Math.ceil(audio.currentTime));
slider.setAttribute("max", audio.duration);

playMusic.addEventListener("click", () => {
  audio.play();
  stopper.removeAttribute("hidden");
  playMusic.setAttribute("hidden", true);
});

stopper.addEventListener("click", () => {
  audio.pause();
  playMusic.removeAttribute("hidden");
  stopper.setAttribute("hidden", true);
});

var findLyricIndex = function () {
  if (audio.currentTime === 0) {
    return 0;
  }
  for (var i = 0; i < lyrics.length; i++) {
    if (
      audio.currentTime >= lyrics[i][1] &&
      audio.currentTime <= lyrics[i][2]
    ) {
      return i;
    } else if (lyrics[i][1] >= audio.currentTime) {
      return i;
    }
  }
  return lyrics.length;
};

const renderLyrics = (thisTime) => {
  let returnElement = "...";
  arrLyrics.forEach((element, index) => {
    if (+element[0] <= thisTime && +element[1] >= thisTime) {
      return (returnElement = [elementLyrics[index], index]);
    }
    if (+element[0] < thisTime && +element[1] < thisTime) {
      return (returnElement = [
        elementLyrics[arrLyrics.length - 1],
        arrLyrics.length - 1,
      ]);
    }
  });
  return returnElement;
};

let showLyrics;
let thisLyrics;

const changeTextColor = (start, listLyrics, duration) => {
  let timeChangeColor = duration / listLyrics.length;
  let index = start;

  if (lyricsTag.children[index]) {
    handleChangeColor = setInterval(() => {
      // lyricsTag.children[index].style.cssText = `
      // color: red;
      // transition: ${timeChangeColor * 1000}`;
      // lyricsTag.children[index].animate(
      //   [{ color: "red" }],
      //   {
      //     duration: 600,
      //   }
      // );
      lyricsTag.children[index].setAttribute(
        "style",
        `color: red;transition: ${timeChangeColor * 1000} linear`
      );
      index += 1;
      if (index >= listLyrics.length) {
        clearInterval(handleChangeColor);
        index = 0;
      }
    }, timeChangeColor * 1000);
  }
};

const getElementIndexLyrics = (lyrics, timer) => {
  for (let i = 0; i < lyrics[0].children.length; i++) {
    if (Number(showLyrics[0].children[i].getAttribute("va")) >= timer) {
      return i - 1;
    }
  }
  return lyrics[0].children.length - 1;
};

const clickChangeColor = (listLyrics, currentTimeAudio) => {
  let end = getElementIndexLyrics(listLyrics, currentTimeAudio);
  for (let i = 0; i < end; i++) {
    lyricsTag.children[i].style.color = "red";
  }
};

slider.addEventListener("change", () => {
  if (audio.paused) {
    clearInterval(handleAudio);
  }
  let thisLyrics = renderLyrics(audio.currentTime);
  audio.currentTime = slider.value;
  currentTime.innerText = NumToTime(Math.ceil(audio.currentTime));
  showLyrics = renderLyrics(audio.currentTime);
  let end;
  end = showLyrics[0].children
    ? getElementIndexLyrics(showLyrics, audio.currentTime)
    : 0;
  for (let i = 0; i < end; i++) {
    showLyrics[0].children[i].setAttribute("style", "color:red");
  }

  if (thisLyrics[0].innerHTML != showLyrics[0].innerHTML) {
    lyricsTag.innerHTML = showLyrics[0].innerHTML
      ? showLyrics[0].innerHTML
      : ". . .";

    if (arrLyrics[showLyrics[1] + 1]) {
      sublyricsTag.innerHTML = arrLyrics[showLyrics[1] + 1][2];
    } else if (audio.currentTime < docLyrics[0][0]) {
      sublyricsTag.innerHTML = arrLyrics[0][2];
    } else {
      sublyricsTag.innerHTML = ". . .";
    }
    thisLyrics = showLyrics;

    if (thisLyrics[0].children) {
      clickChangeColor(thisLyrics, audio.currentTime);
    }

    if (!audio.paused && lyricsTag.innerHTML != ". . .") {
      clearInterval(handleChangeColor);
      let timmm =
        Number(
          showLyrics[0].children[
            showLyrics[0].children.length - 1
          ].getAttribute("va")
        ) - audio.currentTime;
      changeTextColor(0, showLyrics[0].children, timmm);
    }
  }
  if (audio.ended) {
    audio.currentTime = 0;
    currentTime.innerText = NumToTime(Math.ceil(audio.currentTime));
    slider.value = audio.currentTime;
    playMusic.removeAttribute("hidden");
    stopper.setAttribute("hidden", true);
    clearInterval(handleAudio);
    clearInterval(handleChangeColor);
  }
});

lyricsTag.innerHTML = ". . .";
sublyricsTag.innerHTML = arrLyrics[0][2];

audio.addEventListener("play", () => {
  if (showLyrics && showLyrics[0].children[0]) {
    let start = getElementIndexLyrics(showLyrics, audio.currentTime);
    let durationTime =
      Number(
        showLyrics[0].children[showLyrics[0].children.length - 1].getAttribute(
          "va"
        )
      ) - Number(showLyrics[0].children[0].getAttribute("va"));
    changeTextColor(start, showLyrics[0].children, durationTime);
  }
  thisLyrics = renderLyrics(audio.currentTime);
  handleAudio = setInterval(() => {
    slider.value = audio.currentTime;
    currentTime.innerText = NumToTime(Math.ceil(audio.currentTime));
    showLyrics = renderLyrics(audio.currentTime);

    if (thisLyrics[0].innerHTML != showLyrics[0].innerHTML) {
      lyricsTag.innerHTML = showLyrics[0].innerHTML
        ? showLyrics[0].innerHTML
        : ". . .";

      if (arrLyrics[showLyrics[1] + 1]) {
        sublyricsTag.innerHTML = arrLyrics[showLyrics[1] + 1][2];
      } else if (audio.currentTime < docLyrics[0][0]) {
        sublyricsTag.innerHTML = arrLyrics[0][2];
      } else {
        sublyricsTag.innerHTML = ". . .";
      }
      thisLyrics = showLyrics;

      if (!audio.paused && lyricsTag.innerHTML != ". . .") {
        let timmm =
          Number(
            showLyrics[0].children[
              showLyrics[0].children.length - 1
            ].getAttribute("va")
          ) - audio.currentTime;
        clearInterval(handleChangeColor);
        let start = getElementIndexLyrics(showLyrics, audio.currentTime);
        changeTextColor(start, showLyrics[0].children, timmm);
      }
    }

    if (audio.ended) {
      playMusic.removeAttribute("hidden");
      stopper.setAttribute("hidden", true);
      audio.currentTime = 0;
      currentTime.innerText = NumToTime(Math.ceil(audio.currentTime));
      slider.value = audio.currentTime;
      clearInterval(handleAudio);
      clearInterval(handleChangeColor);
    }
  }, 300);
});

audio.addEventListener("pause", () => {
  if (audio.ended) {
    playMusic.removeAttribute("hidden");
    stopper.setAttribute("hidden", true);
    audio.currentTime = 0;
    currentTime.innerText = NumToTime(Math.ceil(audio.currentTime));
    slider.value = audio.currentTime;
    clearInterval(handleAudio);
  }
  clearInterval(handleChangeColor);
  clearInterval(handleAudio);
});
